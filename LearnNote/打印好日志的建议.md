# 打印好日志的建议

## 选择恰当的日志级别

常见的日志级别：error、warn、info、debug、trace。

- error：错误日志，指比较严重的错误，对正常业务有影响，需要运维配置监控的。
- warn：警告日志，一般的错误，对业务影响不大，但是需要开发关注。
- info：信息日志，记录排查问题的关键信息，如调用时间、出参入参等等。
- debug：用于开发DEBUG的，关键逻辑里面的运行时数据。
- trace：最详细的信息，一般这些信息只记录到日志文件中。

## 日志要打印入参出参

我们并不需要打印很多日志，只需要打印可以快速定位问题的有效日志。一般就是入参出参。

## 选择合适的日志格式

理想的日志格式，应当包括这些最基本的信息：如当前时间戳（一般毫秒精确度）、日志级别、线程名字等等。
```
%d{HH:mm:ss.SSS} %-5level [%thread%][%logger{0}%] %m%n
```

## 遇到if...else等条件时，每个分支尽量都打印日志

当你遇到if...else...或者switch这样的条件时，可以在分支的首行就打印日志，这样排查问题时，就可以通过日志，确定进入了哪个分支，代码逻辑更清晰，也更方便排查问题了。

## 日志级别比较低时，进行日志开关判断

对于trace/debug这些比较低的日志级别，必须进行日志级别的开关判断。
```
if(log.isDebugEnabled){
    log.debug("...")
}
```

## 建议使用参数占位{}，而不是+拼接

使用`+`操作符进行字符串的拼接，有一定的性能损耗。使用占位符仅是替换动作，可以有效提升性能。

## 建议使用异步的方式来输出日志

日志最终会输出到文件或者其它输出流中的，IO性能会有要求的。如果异步，就可以显著提升IO性能。

除非有特殊要求，要不然建议使用异步的方式来输出日志。以`logback`为例，配置异步
```
<appender name="FILE_ASYNC" class="ch.qos.logback.classic.AsyncAppender">
    <appender-ref ref="ASYNC" />
</appender>
```

## 不要使用e.printStackTrace()

理由：

- e.printStackTrace()打印出的堆栈日志跟业务代码日志是交错混合在一起的，通常排查异常日志不太方便。
- e.printStackTrace()语句产生的字符串记录的是堆栈信息，如果信息太长太多，字符串常量池所在的内存块没有空间了，即内存满了，那么用户请求就卡住了。

## 禁止在线上环境开启debug

线上开启debug不久可能会打满磁盘，影响业务系统的正常运行。

## 不要记录了异常，又抛出异常

```
log.error("IO Exception ...")
throw new RuntimeException(e)
```

这样会导致多次打印错误日志，让人迷惑。

## 避免重复打印日志

避免冗余打印日志。

## 日志文件分离

不同类型的日志分离出去，单独打印一份文件。

